C51 COMPILER V9.60.7.0   FLASH                                                             01/19/2026 17:23:13 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE FLASH
OBJECT MODULE PLACED IN .\Release\Objects\flash.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\..\User\flash.c LARGE OPTIMIZE(9,SPEED) BROWSE INTVECTOR(0X000C) INCD
                    -IR(..\..\Libraries\Include;..\..\User) INTERVAL(3) DEBUG OBJECTEXTEND PRINT(.\Release\Listings\flash.lst) OBJECT(.\Relea
                    -se\Objects\flash.obj)

line level    source

   1          #include "flash.h"
   2          
   3          #if FLASH_ENABLE
              
              #if 0
                  // 扇区擦除
                  flash_erase_sector(FLASH_START_ADDR);
                  // 写入数据
                  flash_program(FLASH_START_ADDR, tx_buf, sizeof(tx_buf));
                  // 读取数据
                  flash_read(FLASH_START_ADDR, rx_buf, sizeof(rx_buf));
              #endif
              
              /**
               * @brief  flash erase sector
               * @param  addr : sector address in flash
               * @retval None
               */
              void flash_erase_sector(u8 addr)
              {
                  FLASH_ADDR = 0x3F;
                  FLASH_ADDR = addr;
                  FLASH_PASSWORD = FLASH_PASSWORD(0xB9); // 写入操作密码
                  FLASH_CON = FLASH_SER_TRG(0x1);        // 触发扇区擦除
              
                  while (!(FLASH_STA & FLASH_SER_FLG(0x1)))
                      ; // 等待扇区擦除空闲
              }
              
              /**
               * @brief  flash program
               * @param  addr   : Write data address in flash
               * @param  p_data : Write data to flash
               * @param  len    : Data length
               * @retval None
               */
              void flash_program(u8 addr, u8 *p_data, u8 len)
              {
                  FLASH_ADDR = 0x3F;
                  FLASH_ADDR = addr;
              
                  while (len >= 1)
                  {
                      while (!(FLASH_STA & FLASH_PROG_FLG(0x1)))
                          ; // 等待烧录空闲
                      FLASH_DATA = *(p_data++);
                      FLASH_PASSWORD = FLASH_PASSWORD(0xB9); // 写入操作密码
                      FLASH_CON = FLASH_PROG_TRG(0x1);       // 触发烧录
              
                      len -= 1;
                  }
              }
              
C51 COMPILER V9.60.7.0   FLASH                                                             01/19/2026 17:23:13 PAGE 2   

              /**
               * @brief  flash program
               * @param  addr   : Read data address in flash
               * @param  p_data : Read data to flash
               * @param  len    : Data length
               * @retval None
               */
              void flash_read(u8 addr, u8 *p_data, u8 len)
              {
                  while (len != 0)
                  {
                      *(p_data++) = *((u8 code *)(0x3F00 + addr++));
                      len--;
                  }
              }
              
              #endif


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   ----    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
