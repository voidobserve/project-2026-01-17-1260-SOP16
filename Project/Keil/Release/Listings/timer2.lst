C51 COMPILER V9.60.7.0   TIMER2                                                            01/29/2026 16:51:30 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE TIMER2
OBJECT MODULE PLACED IN .\Release\Objects\timer2.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\..\User\timer2.c LARGE OPTIMIZE(9,SPEED) BROWSE INTVECTOR(0X000C) INC
                    -DIR(..\..\Libraries\Include;..\..\User) INTERVAL(3) DEBUG OBJECTEXTEND PRINT(.\Release\Listings\timer2.lst) OBJECT(.\Rel
                    -ease\Objects\timer2.obj)

line level    source

   1          #include "timer2.h"
   2          #include "power_on.h"
   3          #define TIMER2_PEROID_VAL (SYSCLK / 128 / 10000 - 1) // Âë®ÊúüÂÄº=Á≥ªÁªüÊó∂Èíü/ÂàÜÈ¢ë/È¢ëÁéá - 1
   4          
   5          static volatile u16 pwm_duty_add_cnt; // Áî®‰∫éÊéßÂà∂pwmÂ¢ûÂä†ÁöÑÊó∂Èó¥ËÆ°Êï∞
   6          static volatile u16 pwm_duty_sub_cnt; // Áî®‰∫éÊéßÂà∂pwmÈÄíÂáèÁöÑÊó∂Èó¥ËÆ°Êï∞
   7          
   8          volatile bit flag_is_pwm_add_time_comes = 0; // Ê†áÂøó‰ΩçÔºåpwmÂç†Á©∫ÊØîÈÄíÂ¢ûÊó∂Èó¥Âà∞Êù•
   9          volatile bit flag_is_pwm_sub_time_comes = 0; // Ê†áÂøó‰ΩçÔºåpwmÂç†Á©∫ÊØîÈÄíÂáèÊó∂Èó¥Âà∞Êù•
  10          
  11          static volatile u16 pwm_duty_change_cnt = 0; // Áî®‰∫éÊéßÂà∂pwmÂèòÂåñÁöÑÊó∂Èó¥ËÆ°Êï∞ÔºàÁî®Âú®ÊóãÈíÆË∞ÉËäÇÁ
             -öÑPWMÂç†Á©∫ÊØî‰∏≠Ôºâ
  12          
  13          void timer2_config(void)
  14          {
  15   1          __EnableIRQ(TMR2_IRQn); // ‰ΩøËÉΩtimer2‰∏≠Êñ≠
  16   1          IE_EA = 1;              // ‰ΩøËÉΩÊÄª‰∏≠Êñ≠
  17   1      
  18   1          // ËÆæÁΩÆtimer2ÁöÑËÆ°Êï∞ÂäüËÉΩÔºåÈÖçÁΩÆ‰∏Ä‰∏™È¢ëÁéá‰∏∫ 10 kHzÁöÑ‰∏≠Êñ≠
  19   1          TMR_ALLCON = TMR2_CNT_CLR(0x1);                               // Ê∏ÖÈô§ËÆ°Êï∞ÂÄº
  20   1          TMR2_PRH = TMR_PERIOD_VAL_H((TIMER2_PEROID_VAL >> 8) & 0xFF); // Âë®ÊúüÂÄº
  21   1          TMR2_PRL = TMR_PERIOD_VAL_L((TIMER2_PEROID_VAL >> 0) & 0xFF);
  22   1          TMR2_CONH = TMR_PRD_PND(0x1) | TMR_PRD_IRQ_EN(0x1);                          // ËÆ°Êï∞Á≠â‰∫éÂë®ÊúüÊó∂Â
             -ÖÅËÆ∏ÂèëÁîü‰∏≠Êñ≠
  23   1          TMR2_CONL = TMR_SOURCE_SEL(0x7) | TMR_PRESCALE_SEL(0x7) | TMR_MODE_SEL(0x1); // ÈÄâÊã©Á≥ªÁªüÊó∂ÈíüÔºå1
             -28ÂàÜÈ¢ëÔºåËÆ°Êï∞Ê®°Âºè
  24   1      }
  25          
  26          // ÂÆöÊó∂Âô® ‰∏≠Êñ≠ÊúçÂä°ÂáΩÊï∞
  27          void TIMR2_IRQHandler(void) interrupt TMR2_IRQn
  28          {
  29   1          // ËøõÂÖ•‰∏≠Êñ≠ËÆæÁΩÆIPÔºå‰∏çÂèØÂà†Èô§
  30   1          __IRQnIPnPush(TMR2_IRQn);
  31   1      
  32   1          // ---------------- Áî®Êà∑ÂáΩÊï∞Â§ÑÁêÜ -------------------
  33   1      
  34   1          // Âë®Êúü‰∏≠Êñ≠
  35   1          if (TMR2_CONH & TMR_PRD_PND(0x1)) // Á∫¶100usËß¶Âèë‰∏ÄÊ¨°‰∏≠Êñ≠
  36   1          {
  37   2              TMR2_CONH |= TMR_PRD_PND(0x1); // Ê∏ÖÈô§pending
  38   2      
  39   2              // tmr2_cnt++;
  40   2              // P13 = ~P13; // ÊµãËØï‰∏≠Êñ≠Ëß¶ÂèëÂë®Êúü
  41   2      
  42   2              pwm_duty_add_cnt++;
  43   2              pwm_duty_sub_cnt++;
  44   2              pwm_duty_change_cnt++;
  45   2      
  46   2              if (pwm_duty_sub_cnt >= 13) // 1300usÔºå1.3ms
  47   2              // if (pwm_duty_sub_cnt >= 50)
  48   2              {
  49   3                  pwm_duty_sub_cnt = 0;
  50   3                  flag_is_pwm_sub_time_comes = 1;
C51 COMPILER V9.60.7.0   TIMER2                                                            01/29/2026 16:51:30 PAGE 2   

  51   3              }
  52   2      
  53   2              // if (pwm_duty_add_cnt >= 133) // 13300us, 13.3ms
  54   2              if (pwm_duty_add_cnt >= 13) //
  55   2              {
  56   3                  pwm_duty_add_cnt = 0;
  57   3                  flag_is_pwm_add_time_comes = 1;
  58   3              }
  59   2      
  60   2      #if 1 // rf‰ø°Âè∑Êé•Êî∂ Ôºà100usË∞ÉÁî®‰∏ÄÊ¨°Ôºâ
  61   2              {
  62   3                  static volatile u8 rf_bit_cnt;            // RF‰ø°Âè∑Êé•Êî∂ÁöÑÊï∞ÊçÆ‰ΩçËÆ°Êï∞ÂÄº
  63   3                  static volatile u32 __rf_data;            // ÂÆöÊó∂Âô®‰∏≠Êñ≠‰ΩøÁî®ÁöÑÊé•Êî∂ÁºìÂÜ≤Âå∫ÔºåÈÅøÂÖçÁ
             -õ¥Êé•Ë¶ÜÁõñÂÖ®Â±ÄÁöÑÊï∞ÊçÆÊé•Êî∂ÁºìÂÜ≤Âå∫
  64   3                  static volatile u8 flag_is_enable_recv;   // ÊòØÂê¶‰ΩøËÉΩÊé•Êî∂ÁöÑÊ†áÂøó‰ΩçÔºåË¶ÅÊé•Êî∂Âà∞ 5ms
             -+ ÁöÑ‰ΩéÁîµÂπ≥ÊâçÂºÄÂßãÊé•Êî∂
  65   3                  static volatile u8 __flag_is_recved_data; // Ë°®Á§∫‰∏≠Êñ≠ÊúçÂä°ÂáΩÊï∞Êé•Êî∂Âà∞‰∫ÜrfÊï∞ÊçÆ
  66   3      
  67   3                  static volatile u8 low_level_cnt;  // RF‰ø°Âè∑‰ΩéÁîµÂπ≥ËÆ°Êï∞ÂÄº
  68   3                  static volatile u8 high_level_cnt; // RF‰ø°Âè∑È´òÁîµÂπ≥ËÆ°Êï∞ÂÄº
  69   3      
  70   3                  // Âú®ÂÆöÊó∂Âô® ‰∏≠Êâ´ÊèèÁ´ØÂè£ÁîµÂπ≥
  71   3                  if (0 == RFIN_PIN)
  72   3                  {
  73   4                      // Â¶ÇÊûúRFÊé•Êî∂ÂºïËÑö‰∏∫‰ΩéÁîµÂπ≥ÔºåËÆ∞ÂΩï‰ΩéÁîµÂπ≥ÁöÑÊåÅÁª≠Êó∂Èó¥
  74   4                      low_level_cnt++;
  75   4      
  76   4                      /*
  77   4                          ‰∏ãÈù¢ÁöÑÂà§Êñ≠Êù°‰ª∂ÊòØÈÅøÂÖçÈÉ®ÂàÜÈÅ•ÊéßÂô®ÊàñÊé•Êî∂Ê®°ÂùóÂè™ÂèëÈÄÅ24‰ΩçÊï∞ÊçÆÔºåÊúÄ
             -Âêé‰∏çÊãâÈ´òÁîµÂπ≥ÁöÑÊÉÖÂÜµ
  78   4                      */
  79   4                      if (low_level_cnt >= 30 && rf_bit_cnt == 23) // Â¶ÇÊûú‰ΩéÁîµÂπ≥Â§ß‰∫é3000usÔºåÂπ∂‰∏îÂ∑≤Áªè
             -Êé•Êî∂‰∫Ü23‰ΩçÊï∞ÊçÆ
  80   4                      {
  81   5                          if (high_level_cnt >= 6 && high_level_cnt < 20)
  82   5                          {
  83   6                              __rf_data |= 0x01;
  84   6                          }
  85   5                          else if (high_level_cnt >= 1 && high_level_cnt < 6)
  86   5                          {
  87   6                          }
  88   5      
  89   5                          __flag_is_recved_data = 1; // Êé•Êî∂ÂÆåÊàêÊ†áÂøó‰ΩçÁΩÆ‰∏Ä
  90   5                          flag_is_enable_recv = 0;
  91   5                      }
  92   4                  }
  93   3                  else
  94   3                  {
  95   4                      if (low_level_cnt > 0)
  96   4                      {
  97   5                          // Â¶ÇÊûú‰πãÂâçÊé•Êî∂Âà∞‰∫Ü‰ΩéÁîµÂπ≥‰ø°Âè∑ÔºåÁé∞Âú®ÈÅáÂà∞‰∫ÜÈ´òÁîµÂπ≥ÔºåÂà§Êñ≠ÊòØÂê¶Êé
             -•Êî∂ÂÆåÊàê‰∫Ü‰∏Ä‰ΩçÊï∞ÊçÆ
  98   5                          if (low_level_cnt > 50)
  99   5                          {
 100   6                              // Â¶ÇÊûú‰ΩéÁîµÂπ≥ÊåÅÁª≠Êó∂Èó¥Â§ß‰∫é50 * 100usÔºà5msÔºâÔºåÂáÜÂ§á‰∏ã‰∏ÄÊ¨°ÂÜçËØªÂèñ
             -ÊúâÊïà‰ø°Âè∑
 101   6                              __rf_data = 0;  // Ê∏ÖÈô§Êé•Êî∂ÁöÑÊï∞ÊçÆÂ∏ß
 102   6                              rf_bit_cnt = 0; // Ê∏ÖÈô§Áî®Êù•ËÆ∞ÂΩïÊé•Êî∂ÁöÑÊï∞ÊçÆ‰ΩçÊï∞
 103   6      
 104   6                              flag_is_enable_recv = 1;
 105   6                          }
 106   5                          else if (flag_is_enable_recv &&
C51 COMPILER V9.60.7.0   TIMER2                                                            01/29/2026 16:51:30 PAGE 3   

 107   5                                   low_level_cnt >= 2 && low_level_cnt < 7 &&
 108   5                                   high_level_cnt >= 6 && high_level_cnt < 20)
 109   5                          {
 110   6                              // Â¶ÇÊûú‰ΩéÁîµÂπ≥ÊåÅÁª≠Êó∂Èó¥Âú®360usÂ∑¶Âè≥ÔºåÈ´òÁîµÂπ≥ÊåÅÁª≠Êó∂Èó¥Âú®760usÂ∑¶Âè≥
             -ÔºåËØ¥ÊòéÊé•Êî∂Âà∞‰∫Ü1
 111   6                              __rf_data |= 0x01;
 112   6                              rf_bit_cnt++;
 113   6                              if (rf_bit_cnt != 24)
 114   6                              {
 115   7                                  __rf_data <<= 1; // Áî®‰∫éÂ≠òÊîæÊé•Êî∂24‰ΩçÊï∞ÊçÆÁöÑÂèòÈáèÂ∑¶Áßª‰∏Ä‰Ωç
 116   7                              }
 117   6                          }
 118   5                          else if (flag_is_enable_recv &&
 119   5                                   low_level_cnt >= 7 && low_level_cnt < 20 &&
 120   5                                   high_level_cnt >= 1 && high_level_cnt < 6)
 121   5                          {
 122   6                              // Â¶ÇÊûú‰ΩéÁîµÂπ≥ÊåÅÁª≠Êó∂Èó¥Âú®840usÂ∑¶Âè≥ÔºåÈ´òÁîµÂπ≥ÊåÅÁª≠Êó∂Èó¥Âú®360usÂ∑¶Âè≥
             -ÔºåËØ¥ÊòéÊé•Êî∂Âà∞‰∫Ü0
 123   6                              __rf_data &= ~1;
 124   6                              rf_bit_cnt++;
 125   6                              if (rf_bit_cnt != 24)
 126   6                              {
 127   7                                  __rf_data <<= 1; // Áî®‰∫éÂ≠òÊîæÊé•Êî∂24‰ΩçÊï∞ÊçÆÁöÑÂèòÈáèÂ∑¶Áßª‰∏Ä‰Ωç
 128   7                              }
 129   6                          }
 130   5                          else
 131   5                          {
 132   6                              // Â¶ÇÊûú‰ΩéÁîµÂπ≥ÊåÅÁª≠Êó∂Èó¥‰∏çÁ¨¶Âêà0Âíå1ÁöÑÂà§Êñ≠Êù°‰ª∂ÔºåËØ¥ÊòéÊ≠§Êó∂Ê≤°ÊúâÊé
             -•Êî∂Âà∞‰ø°Âè∑
 133   6                              __rf_data = 0;
 134   6                              rf_bit_cnt = 0;
 135   6                              flag_is_enable_recv = 0;
 136   6                          }
 137   5      
 138   5                          low_level_cnt = 0; // Êó†ËÆ∫ÊòØÂê¶Êé•Êî∂Âà∞‰∏Ä‰ΩçÊï∞ÊçÆÔºåÈÅáÂà∞È´òÁîµÂπ≥Êó∂ÔºåÂÖàÊ∏ÖÈ
             -ô§‰πãÂâçÁöÑËÆ°Êï∞ÂÄº
 139   5                          high_level_cnt = 0;
 140   5      
 141   5                          if (24 == rf_bit_cnt)
 142   5                          {
 143   6                              // Â¶ÇÊûúÊé•Êî∂Êàê‰∫Ü24‰ΩçÁöÑÊï∞ÊçÆ
 144   6                              __flag_is_recved_data = 1; // Êé•Êî∂ÂÆåÊàêÊ†áÂøó‰ΩçÁΩÆ‰∏Ä
 145   6                              flag_is_enable_recv = 0;
 146   6                          }
 147   5                      }
 148   4                      else
 149   4                      {
 150   5                          // Â¶ÇÊûúÊé•Êî∂Âà∞È´òÁîµÂπ≥ÂêéÔºå‰ΩéÁîµÂπ≥ÁöÑËÆ°Êï∞‰∏∫0
 151   5      
 152   5                          if (0 == flag_is_enable_recv)
 153   5                          {
 154   6                              __rf_data = 0;
 155   6                              rf_bit_cnt = 0;
 156   6                              flag_is_enable_recv = 0;
 157   6                          }
 158   5                      }
 159   4      
 160   4                      // Â¶ÇÊûúRFÊé•Êî∂ÂºïËÑö‰∏∫È´òÁîµÂπ≥ÔºåËÆ∞ÂΩïÈ´òÁîµÂπ≥ÁöÑÊåÅÁª≠Êó∂Èó¥
 161   4                      high_level_cnt++;
 162   4                  }
 163   3      
 164   3                  if (__flag_is_recved_data) //
C51 COMPILER V9.60.7.0   TIMER2                                                            01/29/2026 16:51:30 PAGE 4   

 165   3                  {
 166   4                      rf_bit_cnt = 0;
 167   4                      __flag_is_recved_data = 0;
 168   4                      low_level_cnt = 0;
 169   4                      high_level_cnt = 0;
 170   4      
 171   4                      // if (rf_data != 0)
 172   4                      // if (0 == flag_is_recved_rf_data) /* Â¶ÇÊûú‰πãÂâçÊú™Êé•Êî∂Âà∞Êï∞ÊçÆ ÊàñÊòØ Â∑≤ÁªèÂ§ÑÁêÜÂ
             -Æå‰∏ä‰∏ÄÊ¨°Êé•Êî∂Âà∞ÁöÑÊï∞ÊçÆ */
 173   4                      {
 174   5                          // Áé∞Âú®Êîπ‰∏∫Âè™Ë¶ÅÊî∂Âà∞Êñ∞ÁöÑÊï∞ÊçÆÔºåÂ∞±Ë¶ÜÁõñrf_data
 175   5                          rf_data = __rf_data;
 176   5                          flag_is_recved_rf_data = 1;
 177   5                      }
 178   4                      // else
 179   4                      // {
 180   4                      //     __rf_data = 0;
 181   4                      // }
 182   4                  }
 183   3              }
 184   2      #endif // rf‰ø°Âè∑Êé•Êî∂ Ôºà100usË∞ÉÁî®‰∏ÄÊ¨°Ôºâ
 185   2      
 186   2      #if 1 // Ë∞ÉËäÇPWMÂç†Á©∫ÊØî
 187   2      
 188   2              // if (pwm_duty_change_cnt >= 10) // 1000us,1ms
 189   2              // if (pwm_duty_change_cnt >= 1) // 100usÔºàÁî®ÈÅ•ÊéßÂô®Ë∞ÉËäÇÔºåÂú®50%‰ª•‰∏äË∞ÉËäÇpwmÂç†Á©∫ÊØîÁöÑ
             -Êó∂ÂÄôÔºåÁÅØÂÖâ‰ºöÊúâÊäñÂä®Ôºâ
 190   2              // if (pwm_duty_change_cnt >= 5) // 500us
 191   2              // if (pwm_duty_change_cnt >= 10) // x * 100us ÔºàÁî®ÈÅ•ÊéßÂô®Ë∞ÉËäÇÂà∞50%‰ª•‰∏ãpwmÂç†Á©∫ÊØîÁöÑÊó∂
             -ÂÄôÔºåÁÅØÂÖâ‰ºöÊúâÊäñÂä®Ôºâ
 192   2              if (pwm_duty_change_cnt >= 20) // x * 100us Ôºà Áî®ÈÅ•ÊéßÂô®Ë∞ÉËäÇÊó∂ÔºåÁÅØÂÖâ‰∏ç‰ºöÊúâÊäñÂä®ÔºåÊ†
             -∑Êú∫ÊúÄÈ´òÂäüÁéá‰∏∫870W--Âä†‰∏äÈ£éÊâáÔºâ
 193   2              // if (pwm_duty_change_cnt >= 30) // x * 100us ÔºàÁî®ÈÅ•ÊéßÂô®Ë∞ÉËäÇÊó∂ÔºåÁÅØÂÖâ‰∏ç‰ºöÊúâÊäñÂä®Ôºå
             -‰ΩÜÊòØË∞ÉËäÇÊó∂Èó¥ËøáÈïøÔºåÊÑüËßâ‰∏çË∑üÊâãÔºâ
 194   2              {
 195   3                  pwm_duty_change_cnt = 0;
 196   3      
 197   3                  if (0 == flag_is_in_power_on) // ‰∏çÂ§Ñ‰∫éÂºÄÊú∫ÁºìÂêØÂä®ÔºåÊâç‰ΩøËÉΩPWMÂç†Á©∫ÊØîË∞ÉËäÇ
 198   3                  {
 199   4                      // =================================================================
 200   4                      // pwm_channel_0                                               //
 201   4                      // =================================================================
 202   4                      if (adjust_pwm_channel_0_duty > cur_pwm_channel_0_duty)
 203   4                      {
 204   5                          cur_pwm_channel_0_duty++;
 205   5                      }
 206   4                      else if (adjust_pwm_channel_0_duty < cur_pwm_channel_0_duty)
 207   4                      {
 208   5                          cur_pwm_channel_0_duty--;
 209   5                      }
 210   4      
 211   4                      // =================================================================
 212   4                      // pwm_channel_1                                               //
 213   4                      // =================================================================
 214   4                      if (adjust_pwm_channel_1_duty > cur_pwm_channel_1_duty)
 215   4                      {
 216   5                          cur_pwm_channel_1_duty++;
 217   5                      }
 218   4                      else if (adjust_pwm_channel_1_duty < cur_pwm_channel_1_duty)
 219   4                      {
 220   5                          cur_pwm_channel_1_duty--;
 221   5                      }
C51 COMPILER V9.60.7.0   TIMER2                                                            01/29/2026 16:51:30 PAGE 5   

 222   4      
 223   4                      set_pwm_channel_0_duty(cur_pwm_channel_0_duty);
 224   4                      set_pwm_channel_1_duty(cur_pwm_channel_1_duty);
 225   4      
 226   4      #if 0
                              if (cur_pwm_channel_0_duty <= 0)
                              {
                                  // Â∞è‰∫éÊüê‰∏™ÂÄºÔºåÁõ¥Êé•ËæìÂá∫0%Âç†Á©∫ÊØîÔºåÂÖ≥Èó≠PWMËæìÂá∫ÔºåÂºïËÑöÈÖçÁΩÆ‰∏∫ËæìÂá∫
             -Ê®°Âºè
                                  pwm_channel_0_disable();
                              }
                              else // Â¶ÇÊûúÂ§ß‰∫é0
                              {
                                  pwm_channel_0_enable();
                              }
              
                              if (cur_pwm_channel_1_duty <= 0)
                              {
                                  // Â∞è‰∫éÊüê‰∏™ÂÄºÔºåÁõ¥Êé•ËæìÂá∫0%Âç†Á©∫ÊØîÔºåÂÖ≥Èó≠PWMËæìÂá∫ÔºåÂºïËÑöÈÖçÁΩÆ‰∏∫ËæìÂá∫
             -Ê®°Âºè
                                  pwm_channel_1_disable();
                              }
                              else // Â¶ÇÊûúÂ§ß‰∫é0
                              {
                                  pwm_channel_1_enable();
                              }
              #endif
 247   4      
 248   4                  } // if (0 == flag_is_in_power_on) // ‰∏çÂ§Ñ‰∫éÂºÄÊú∫ÁºìÂêØÂä®ÔºåÊâç‰ΩøËÉΩPWMÂç†Á©∫ÊØîË∞ÉËäÇ
 249   3      
 250   3      #if 0
                          // printf("c_duty %u\n", c_duty);
                          // printf(",c=%u\n", c_duty);
              #endif
 254   3              }
 255   2      #endif // Ë∞ÉËäÇPWMÂç†Á©∫ÊØî
 256   2      
 257   2      // USER_TO_DO Âú®ÊµãËØïÊó∂Â±èËîΩ
 258   2      #if 1
 259   2              {
 260   3                  static volatile u16 cnt = 0; // ÊéßÂà∂Èó™ÁÉÅÁÅØÁöÑÊó∂Èó¥Èó¥Èöî
 261   3                  static volatile bit dir = 0; // ÊéßÂà∂Èó™ÁÉÅÁÅØÁöÑÈó™ÁÉÅÊñπÂêë
 262   3      
 263   3                  if (pwm_mode >= PWM_MODE_PULSE_1 &&
 264   3                      pwm_mode <= PWM_MODE_PULSE_5)
 265   3                  {
 266   4                      u16 dest_cnt = 0;
 267   4                      if (pwm_mode == PWM_MODE_PULSE_1)
 268   4                      {
 269   5                          // PWM_MODE_PULSE_1 1Hz,500ms‰∫ÆÔºå500msÁÅ≠
 270   5                          dest_cnt = 5000;
 271   5                      }
 272   4                      else if (pwm_mode == PWM_MODE_PULSE_2)
 273   4                      {
 274   5                          // PWM_MODE_PULSE_2 3Hz,166.6ms‰∫ÆÔºàÂçïÁâáÊú∫Âè™ËÉΩÂèñÊï¥ÔºâÔºå166.6msÁÅ≠
 275   5                          dest_cnt = 1666;
 276   5                      }
 277   4                      else if (pwm_mode == PWM_MODE_PULSE_3)
 278   4                      {
 279   5                          // PWM_MODE_PULSE_3 5Hz,100ms‰∫ÆÔºå100msÁÅ≠
 280   5                          dest_cnt = 1000;
 281   5                      }
C51 COMPILER V9.60.7.0   TIMER2                                                            01/29/2026 16:51:30 PAGE 6   

 282   4                      else if (pwm_mode == PWM_MODE_PULSE_4)
 283   4                      {
 284   5                          // PWM_MODE_PULSE_4 10Hz,50ms‰∫ÆÔºå50msÁÅ≠
 285   5                          dest_cnt = 500;
 286   5                      }
 287   4                      else if (pwm_mode == PWM_MODE_PULSE_5)
 288   4                      {
 289   5                          // PWM_MODE_PULSE_5 15Hz,33.3ms‰∫ÆÔºàÂçïÁâáÊú∫Âè™ËÉΩÂèñÊï¥ÔºâÔºå33.3msÁÅ≠
 290   5                          dest_cnt = 333;
 291   5                      }  
 292   4      
 293   4                      cnt++;
 294   4                      if (cnt >= dest_cnt)
 295   4                      {
 296   5                          cnt = 0;
 297   5                          dir = !dir;
 298   5                      }
 299   4      
 300   4                      if (dir == 0)
 301   4                      {
 302   5                          if (!get_pwm_channel_0_status())
 303   5                          {
 304   6                              pwm_channel_0_enable();
 305   6                          }
 306   5      
 307   5                          if (!get_pwm_channel_1_status())
 308   5                          {
 309   6                              pwm_channel_1_enable();
 310   6                          }
 311   5                      }
 312   4                      else
 313   4                      {
 314   5                          if (get_pwm_channel_0_status())
 315   5                          {
 316   6                              pwm_channel_0_disable();
 317   6                          }
 318   5      
 319   5                          if (get_pwm_channel_1_status())
 320   5                          {
 321   6                              pwm_channel_1_disable();
 322   6                          }
 323   5                      }
 324   4                  }
 325   3                  else
 326   3                  {
 327   4                      // Â¶ÇÊûú‰∏çÂú®ËÑâÂÜ≤Ê®°Âºè
 328   4                      cnt = 0;
 329   4                      dir = 0;
 330   4      
 331   4                      /*
 332   4                          ÁõÆÂâçÂè™ÊúâËÑâÂÜ≤Ê®°ÂºèÔºàpwm_mode == PWM_MODE_PULSEÔºâ‰∏ã
 333   4                          ‰ºöÊääpwmÂÖ≥Èó≠ÔºåÂ¶ÇÊûúÈÄÄÂá∫‰∫ÜËÑâÂÜ≤Ê®°ÂºèÔºåË¶ÅÈáçÊñ∞ÊâìÂºÄpwm
 334   4                      */
 335   4      
 336   4                      if (!get_pwm_channel_0_status())
 337   4                      {
 338   5                          pwm_channel_0_enable();
 339   5                      }
 340   4      
 341   4                      if (!get_pwm_channel_1_status())
 342   4                      {
 343   5                          pwm_channel_1_enable();
C51 COMPILER V9.60.7.0   TIMER2                                                            01/29/2026 16:51:30 PAGE 7   

 344   5                      }
 345   4                  }
 346   3              }
 347   2      #endif
 348   2          }
 349   1      
 350   1          // ÈÄÄÂá∫‰∏≠Êñ≠ËÆæÁΩÆIPÔºå‰∏çÂèØÂà†Èô§
 351   1          __IRQnIPnPop(TMR2_IRQn);
 352   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    944    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     17       2
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      3    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
