C51 COMPILER V9.60.7.0   RF_RECV                                                           01/17/2026 16:42:34 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE RF_RECV
OBJECT MODULE PLACED IN .\Release\Objects\rf_recv.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\..\User\rf_recv.c LARGE OPTIMIZE(9,SIZE) BROWSE INTVECTOR(0X000C) INC
                    -DIR(..\..\Libraries\Include;..\..\User) INTERVAL(3) DEBUG OBJECTEXTEND PRINT(.\Release\Listings\rf_recv.lst) OBJECT(.\Re
                    -lease\Objects\rf_recv.obj)

line level    source

   1          #include "rf_recv.h"
   2           
   3          
   4          // rfå¯¹ç æœŸé—´ï¼Œç”¨äºä¸´æ—¶å­˜æ”¾é¥æ§å™¨åœ°å€çš„å˜é‡
   5          // åœ¨ rf_key_get_key_id() å‡½æ•°ä¸­å–å¾—ï¼Œå¦‚æœå¯¹ç æˆåŠŸï¼Œåˆ™ç›´æ¥åº”ç”¨è¯¥åœ°å€ï¼Œå†™å…¥flash
   6          volatile u32 tmp_rf_addr = 0xFFFFFFFF;
   7          volatile rf_remote_info_t rf_remote_info = {0};
   8          
   9          volatile bit flag_is_rf_enable = 0;      // æ ‡å¿—ä½ï¼Œæ˜¯å¦ä½¿èƒ½rfé¥æ§å™¨çš„åŠŸèƒ½
  10          volatile bit flag_is_recved_rf_data = 0; // æ˜¯å¦æ¥æ”¶åˆ°äº†rfä¿¡å·
  11          volatile u32 rf_data = 0;                // å­˜æ”¾æ¥æ”¶åˆ°çš„rfæ•°æ®
  12          
  13          // // å°†æŒ‰é”®é”®å€¼ä¸
  14          // static const u8 rf_key_map_table[][2] =
  15          // {
  16          
  17          // }
  18          
  19          // å®šä¹‰è§¦æ‘¸æŒ‰é”®çš„æŒ‰é”®äº‹ä»¶
  20          enum RF_KEY_EVENT
  21          {
  22              RF_KEY_EVENT_NONE = 0,
  23              RF_KEY_EVENT_ID_1_CLICK,
  24              RF_KEY_EVENT_ID_1_LONG,
  25              RF_KEY_EVENT_ID_1_HOLD,
  26              RF_KEY_EVENT_ID_1_LOOSE,
  27          
  28              RF_KEY_EVENT_ID_2_CLICK,
  29              RF_KEY_EVENT_ID_2_LONG,
  30              RF_KEY_EVENT_ID_2_HOLD,
  31              RF_KEY_EVENT_ID_2_LOOSE,
  32          
  33              RF_KEY_EVENT_ID_3_CLICK,
  34              RF_KEY_EVENT_ID_3_LONG,
  35              RF_KEY_EVENT_ID_3_HOLD,
  36              RF_KEY_EVENT_ID_3_LOOSE,
  37          
  38              RF_KEY_EVENT_ID_4_CLICK,
  39              RF_KEY_EVENT_ID_4_LONG,
  40              RF_KEY_EVENT_ID_4_HOLD,
  41              RF_KEY_EVENT_ID_4_LOOSE,
  42          
  43              RF_KEY_EVENT_ID_5_CLICK,
  44              RF_KEY_EVENT_ID_5_LONG,
  45              RF_KEY_EVENT_ID_5_HOLD,
  46              RF_KEY_EVENT_ID_5_LOOSE,
  47          
  48              RF_KEY_EVENT_ID_6_CLICK,
  49              RF_KEY_EVENT_ID_6_LONG,
  50              RF_KEY_EVENT_ID_6_HOLD,
  51              RF_KEY_EVENT_ID_6_LOOSE,
  52          
  53              RF_KEY_EVENT_ID_7_CLICK,
C51 COMPILER V9.60.7.0   RF_RECV                                                           01/17/2026 16:42:34 PAGE 2   

  54              RF_KEY_EVENT_ID_7_LONG,
  55              RF_KEY_EVENT_ID_7_HOLD,
  56              RF_KEY_EVENT_ID_7_LOOSE,
  57          
  58              RF_KEY_EVENT_ID_8_CLICK,
  59              RF_KEY_EVENT_ID_8_LONG,
  60              RF_KEY_EVENT_ID_8_HOLD,
  61              RF_KEY_EVENT_ID_8_LOOSE,
  62          
  63              RF_KEY_EVENT_ID_9_CLICK,
  64              RF_KEY_EVENT_ID_9_LONG,
  65              RF_KEY_EVENT_ID_9_HOLD,
  66              RF_KEY_EVENT_ID_9_LOOSE,
  67          
  68              RF_KEY_EVENT_ID_10_CLICK,
  69              RF_KEY_EVENT_ID_10_LONG,
  70              RF_KEY_EVENT_ID_10_HOLD,
  71              RF_KEY_EVENT_ID_10_LOOSE,
  72          
  73              RF_KEY_EVENT_ID_11_CLICK,
  74              RF_KEY_EVENT_ID_11_LONG,
  75              RF_KEY_EVENT_ID_11_HOLD,
  76              RF_KEY_EVENT_ID_11_LOOSE,
  77          
  78              RF_KEY_EVENT_ID_12_CLICK,
  79              RF_KEY_EVENT_ID_12_LONG,
  80              RF_KEY_EVENT_ID_12_HOLD,
  81              RF_KEY_EVENT_ID_12_LOOSE,
  82          
  83          #if USE_MY_TEST_433_REMOTE
              
                  // æµ‹è¯•æ—¶ä½¿ç”¨åˆ°çš„æŒ‰é”®äº‹ä»¶ï¼Œå®é™…ä¸ä½¿ç”¨
                  RF_KEY_EVENT_ID_TEST_1_CLICK,
                  RF_KEY_EVENT_ID_TEST_1_LONG,
                  RF_KEY_EVENT_ID_TEST_1_HOLD,
                  RF_KEY_EVENT_ID_TEST_1_LOOSE,
              
                  RF_KEY_EVENT_ID_TEST_2_CLICK,
                  RF_KEY_EVENT_ID_TEST_2_LONG,
                  RF_KEY_EVENT_ID_TEST_2_HOLD,
                  RF_KEY_EVENT_ID_TEST_2_LOOSE,
              
                  RF_KEY_EVENT_ID_TEST_3_CLICK,
                  RF_KEY_EVENT_ID_TEST_3_LONG,
                  RF_KEY_EVENT_ID_TEST_3_HOLD,
                  RF_KEY_EVENT_ID_TEST_3_LOOSE,
              
                  RF_KEY_EVENT_ID_TEST_4_CLICK,
                  RF_KEY_EVENT_ID_TEST_4_LONG,
                  RF_KEY_EVENT_ID_TEST_4_HOLD,
                  RF_KEY_EVENT_ID_TEST_4_LOOSE,
              
              #endif // #if USE_MY_TEST_433_REMOTE
 107          };
 108          
 109          #define RF_KEY_EFFECT_EVENT_NUMS (4) // å•ä¸ªè§¦æ‘¸æŒ‰é”®çš„æœ‰æ•ˆæŒ‰é”®äº‹ä»¶ä¸ªæ•° (å•å‡»ã€é•¿æŒ‰ã€æ
             -Œç»­ã€æ¾å¼€)
 110          // å°†æŒ‰é”®idå’ŒæŒ‰é”®äº‹ä»¶ç»‘å®šèµ·æ¥ï¼Œåœ¨ xx å‡½æ•°ä¸­ï¼Œé€šè¿‡æŸ¥è¡¨çš„æ–¹å¼å¾—åˆ°æŒ‰é”®äº‹ä»¶
 111          // static const u8 rf_key_event_table[][RF_KEY_EFFECT_EVENT_NUMS + 1] = {
 112          //     // [0]--æŒ‰é”®å¯¹åº”çš„idå·ï¼Œç”¨äºæŸ¥è¡¨ï¼Œ[1]ã€[2]ã€[3]...--ç”¨äºä¸ key_driver.h ä¸­å®šä¹‰ç
             -š„æŒ‰é”®äº‹ä»¶KEY_EVENTç»‘å®šå…³ç³»(ä¸€å®šè¦ä¸€ä¸€å¯¹åº”)
 113          //     {RF_KEY_ID_1, RF_KEY_EVENT_ID_1_CLICK, RF_KEY_EVENT_ID_1_LONG, RF_KEY_EVENT_ID_1_HOLD, RF_KEY_EVENT
C51 COMPILER V9.60.7.0   RF_RECV                                                           01/17/2026 16:42:34 PAGE 3   

             -_ID_1_LOOSE},      //
 114          //     {RF_KEY_ID_2, RF_KEY_EVENT_ID_2_CLICK, RF_KEY_EVENT_ID_2_LONG, RF_KEY_EVENT_ID_2_HOLD, RF_KEY_EVENT
             -_ID_2_LOOSE},      //
 115          //     {RF_KEY_ID_3, RF_KEY_EVENT_ID_3_CLICK, RF_KEY_EVENT_ID_3_LONG, RF_KEY_EVENT_ID_3_HOLD, RF_KEY_EVENT
             -_ID_3_LOOSE},      //
 116          //     {RF_KEY_ID_4, RF_KEY_EVENT_ID_4_CLICK, RF_KEY_EVENT_ID_4_LONG, RF_KEY_EVENT_ID_4_HOLD, RF_KEY_EVENT
             -_ID_4_LOOSE},      //
 117          //     {RF_KEY_ID_5, RF_KEY_EVENT_ID_5_CLICK, RF_KEY_EVENT_ID_5_LONG, RF_KEY_EVENT_ID_5_HOLD, RF_KEY_EVENT
             -_ID_5_LOOSE},      //
 118          //     {RF_KEY_ID_6, RF_KEY_EVENT_ID_6_CLICK, RF_KEY_EVENT_ID_6_LONG, RF_KEY_EVENT_ID_6_HOLD, RF_KEY_EVENT
             -_ID_6_LOOSE},      //
 119          //     {RF_KEY_ID_7, RF_KEY_EVENT_ID_7_CLICK, RF_KEY_EVENT_ID_7_LONG, RF_KEY_EVENT_ID_7_HOLD, RF_KEY_EVENT
             -_ID_7_LOOSE},      //
 120          //     {RF_KEY_ID_8, RF_KEY_EVENT_ID_8_CLICK, RF_KEY_EVENT_ID_8_LONG, RF_KEY_EVENT_ID_8_HOLD, RF_KEY_EVENT
             -_ID_8_LOOSE},      //
 121          //     {RF_KEY_ID_9, RF_KEY_EVENT_ID_9_CLICK, RF_KEY_EVENT_ID_9_LONG, RF_KEY_EVENT_ID_9_HOLD, RF_KEY_EVENT
             -_ID_9_LOOSE},      //
 122          //     {RF_KEY_ID_10, RF_KEY_EVENT_ID_10_CLICK, RF_KEY_EVENT_ID_10_LONG, RF_KEY_EVENT_ID_10_HOLD, RF_KEY_E
             -VENT_ID_10_LOOSE}, //
 123          //     {RF_KEY_ID_11, RF_KEY_EVENT_ID_11_CLICK, RF_KEY_EVENT_ID_11_LONG, RF_KEY_EVENT_ID_11_HOLD, RF_KEY_E
             -VENT_ID_11_LOOSE}, //
 124          //     {RF_KEY_ID_12, RF_KEY_EVENT_ID_12_CLICK, RF_KEY_EVENT_ID_12_LONG, RF_KEY_EVENT_ID_12_HOLD, RF_KEY_E
             -VENT_ID_12_LOOSE}, //
 125          
 126          // #if USE_MY_TEST_433_REMOTE
 127          
 128          //     {RF_KEY_ID_TEST_1, RF_KEY_EVENT_ID_TEST_1_CLICK, RF_KEY_EVENT_ID_TEST_1_LONG, RF_KEY_EVENT_ID_TEST_
             -1_HOLD, RF_KEY_EVENT_ID_TEST_1_LOOSE}, //
 129          //     {RF_KEY_ID_TEST_2, RF_KEY_EVENT_ID_TEST_2_CLICK, RF_KEY_EVENT_ID_TEST_2_LONG, RF_KEY_EVENT_ID_TEST_
             -2_HOLD, RF_KEY_EVENT_ID_TEST_2_LOOSE}, //
 130          //     {RF_KEY_ID_TEST_3, RF_KEY_EVENT_ID_TEST_3_CLICK, RF_KEY_EVENT_ID_TEST_3_LONG, RF_KEY_EVENT_ID_TEST_
             -3_HOLD, RF_KEY_EVENT_ID_TEST_3_LOOSE}, //
 131          //     {RF_KEY_ID_TEST_4, RF_KEY_EVENT_ID_TEST_4_CLICK, RF_KEY_EVENT_ID_TEST_4_LONG, RF_KEY_EVENT_ID_TEST_
             -4_HOLD, RF_KEY_EVENT_ID_TEST_4_LOOSE}, //
 132          
 133          // #endif // #if USE_MY_TEST_433_REMOTE
 134          // };
 135          
 136          // æ§åˆ¶ä¸€è·¯PWMé¥æ§å™¨å¯¹åº”çš„è¡¨æ ¼
 137          static const u8 rf_key_1_event_table[][RF_KEY_EFFECT_EVENT_NUMS + 1] = {
 138              {RF_KEY_ID_9, RF_KEY_EVENT_ID_9_CLICK, RF_KEY_EVENT_ID_9_LONG, RF_KEY_EVENT_ID_9_HOLD, RF_KEY_EVENT_ID
             -_9_LOOSE},      //
*** ERROR C202 IN LINE 138 OF ..\..\User\rf_recv.c: 'RF_KEY_ID_9': undefined identifier
 139              {RF_KEY_ID_10, RF_KEY_EVENT_ID_10_CLICK, RF_KEY_EVENT_ID_10_LONG, RF_KEY_EVENT_ID_10_HOLD, RF_KEY_EVEN
             -T_ID_10_LOOSE}, //
*** ERROR C202 IN LINE 139 OF ..\..\User\rf_recv.c: 'RF_KEY_ID_10': undefined identifier
 140              {RF_KEY_ID_11, RF_KEY_EVENT_ID_11_CLICK, RF_KEY_EVENT_ID_11_LONG, RF_KEY_EVENT_ID_11_HOLD, RF_KEY_EVEN
             -T_ID_11_LOOSE}, //
*** ERROR C202 IN LINE 140 OF ..\..\User\rf_recv.c: 'RF_KEY_ID_11': undefined identifier
 141              {RF_KEY_ID_12, RF_KEY_EVENT_ID_12_CLICK, RF_KEY_EVENT_ID_12_LONG, RF_KEY_EVENT_ID_12_HOLD, RF_KEY_EVEN
             -T_ID_12_LOOSE}, //
*** ERROR C202 IN LINE 141 OF ..\..\User\rf_recv.c: 'RF_KEY_ID_12': undefined identifier
 142          };
 143          
 144          // æ§åˆ¶ä¸¤è·¯PWMé¥æ§å™¨å¯¹åº”çš„è¡¨æ ¼
 145          static const u8 rf_key_1_2_event_table[][RF_KEY_EFFECT_EVENT_NUMS + 1] = {
 146              {RF_KEY_ID_1, RF_KEY_EVENT_ID_1_CLICK, RF_KEY_EVENT_ID_1_LONG, RF_KEY_EVENT_ID_1_HOLD, RF_KEY_EVENT_ID
             -_1_LOOSE}, //
*** ERROR C202 IN LINE 146 OF ..\..\User\rf_recv.c: 'RF_KEY_ID_1': undefined identifier
 147              {RF_KEY_ID_2, RF_KEY_EVENT_ID_2_CLICK, RF_KEY_EVENT_ID_2_LONG, RF_KEY_EVENT_ID_2_HOLD, RF_KEY_EVENT_ID
             -_2_LOOSE}, //
*** ERROR C202 IN LINE 147 OF ..\..\User\rf_recv.c: 'RF_KEY_ID_2': undefined identifier
C51 COMPILER V9.60.7.0   RF_RECV                                                           01/17/2026 16:42:34 PAGE 4   

 148              {RF_KEY_ID_3, RF_KEY_EVENT_ID_3_CLICK, RF_KEY_EVENT_ID_3_LONG, RF_KEY_EVENT_ID_3_HOLD, RF_KEY_EVENT_ID
             -_3_LOOSE}, //
*** ERROR C202 IN LINE 148 OF ..\..\User\rf_recv.c: 'RF_KEY_ID_3': undefined identifier
 149              {RF_KEY_ID_4, RF_KEY_EVENT_ID_4_CLICK, RF_KEY_EVENT_ID_4_LONG, RF_KEY_EVENT_ID_4_HOLD, RF_KEY_EVENT_ID
             -_4_LOOSE}, //
*** ERROR C202 IN LINE 149 OF ..\..\User\rf_recv.c: 'RF_KEY_ID_4': undefined identifier
 150              {RF_KEY_ID_5, RF_KEY_EVENT_ID_5_CLICK, RF_KEY_EVENT_ID_5_LONG, RF_KEY_EVENT_ID_5_HOLD, RF_KEY_EVENT_ID
             -_5_LOOSE}, //
*** ERROR C202 IN LINE 150 OF ..\..\User\rf_recv.c: 'RF_KEY_ID_5': undefined identifier
 151              {RF_KEY_ID_6, RF_KEY_EVENT_ID_6_CLICK, RF_KEY_EVENT_ID_6_LONG, RF_KEY_EVENT_ID_6_HOLD, RF_KEY_EVENT_ID
             -_6_LOOSE}, //
*** ERROR C202 IN LINE 151 OF ..\..\User\rf_recv.c: 'RF_KEY_ID_6': undefined identifier
 152              {RF_KEY_ID_7, RF_KEY_EVENT_ID_7_CLICK, RF_KEY_EVENT_ID_7_LONG, RF_KEY_EVENT_ID_7_HOLD, RF_KEY_EVENT_ID
             -_7_LOOSE}, //
*** ERROR C202 IN LINE 152 OF ..\..\User\rf_recv.c: 'RF_KEY_ID_7': undefined identifier
 153              {RF_KEY_ID_8, RF_KEY_EVENT_ID_8_CLICK, RF_KEY_EVENT_ID_8_LONG, RF_KEY_EVENT_ID_8_HOLD, RF_KEY_EVENT_ID
             -_8_LOOSE}, //
*** ERROR C202 IN LINE 153 OF ..\..\User\rf_recv.c: 'RF_KEY_ID_8': undefined identifier
 154          };
 155          
 156          extern u8 rf_key_get_key_id(void);
 157          volatile struct key_driver_para rf_key_para = {
 158              // ç¼–è¯‘å™¨ä¸æ”¯æŒæŒ‡å®šæˆå‘˜èµ‹å€¼çš„å†™æ³•ï¼Œä¼šæŠ¥é”™ï¼š
 159              // .scan_times = 10,   // æ‰«æé¢‘ç‡ï¼Œå•ä½ï¼šms
 160              // .last_key = NO_KEY, // ä¸Šä¸€æ¬¡å¾—åˆ°çš„æŒ‰é”®é”®å€¼ï¼Œåˆå§‹åŒ–ä¸ºæ— æ•ˆçš„é”®å€¼
 161              // // .filter_value = NO_KEY, // æŒ‰é”®æ¶ˆæŠ–æœŸé—´å¾—åˆ°çš„é”®å€¼(åœ¨key_driver_scan()å‡½æ•°ä¸­ä½¿ç”¨
             -)ï¼Œåˆå§‹åŒ–ä¸º NO_KEY
 162              // // .filter_cnt = 0, // æŒ‰é”®æ¶ˆæŠ–æœŸé—´çš„ç´¯åŠ å€¼(åœ¨key_driver_scan()å‡½æ•°ä¸­ä½¿ç”¨)ï¼Œåˆå§‹
             -åŒ–ä¸º0
 163              // .filter_time = 3,       // æŒ‰é”®æ¶ˆæŠ–æ¬¡æ•°ï¼Œä¸æ‰«æé¢‘ç‡æœ‰å…³
 164              // .long_time = 50,        // åˆ¤å®šæŒ‰é”®æ˜¯é•¿æŒ‰å¯¹åº”çš„æ•°é‡ï¼Œä¸æ‰«æé¢‘ç‡æœ‰å…³
 165              // .hold_time = (75 + 15), // åˆ¤å®šæŒ‰é”®æ˜¯HOLDå¯¹åº”çš„æ•°é‡ï¼Œä¸æ‰«æé¢‘ç‡æœ‰å…³
 166              // // .press_cnt = 0, // ä¸long_timeå’Œhold_timeå¯¹æ¯”, åˆ¤æ–­é•¿æŒ‰äº‹ä»¶å’ŒHOLDäº‹ä»¶
 167              // // .click_cnt = 0,
 168              // .click_delay_time = 20, // æŒ‰é”®æŠ¬èµ·åï¼Œç­‰å¾…è¿å‡»çš„æ•°é‡ï¼Œä¸æ‰«æé¢‘ç‡æœ‰å…³
 169              // // .notify_value = 0,
 170              // .key_type = KEY_TYPE_AD, // æŒ‰é”®ç±»å‹ä¸ºadæŒ‰é”®
 171              // .get_value = ad_key_get_key_id,
 172          
 173              // .latest_key_val = AD_KEY_ID_NONE,
 174              // .latest_key_event = KEY_EVENT_NONE,
 175          
 176              RF_KEY_SCAN_CIRCLE_TIMES, // .scan_times æ‰«æé¢‘ç‡ï¼Œå•ä½ï¼šms
 177              0,                        // .cur_scan_times æŒ‰é”®æ‰«æé¢‘ç‡, å•ä½msï¼Œç”±1msçš„å®šæ—¶å™¨ä¸­æ–­å†
             -…ç´¯åŠ ï¼Œåœ¨key_driver_scan()ä¸­æ¸…é›¶
 178              // NO_KEY,
 179              0, // .last_key
 180          
 181              0,                   // .filter_value
 182              0,                   // .filter_cnt
 183              RF_KEY_FILTER_TIMES, // .filter_time æŒ‰é”®æ¶ˆæŠ–æ¬¡æ•°ï¼Œä¸æ‰«æé¢‘ç‡æœ‰å…³ï¼ˆrfæŒ‰é”®ä¸æ¶ˆæŠ–ï¼‰
 184          
 185              RF_LONG_PRESS_TIME_THRESHOLD_MS / RF_KEY_SCAN_CIRCLE_TIMES,                                     // .lo
             -ng_time
 186              (RF_LONG_PRESS_TIME_THRESHOLD_MS + RF_HOLD_PRESS_TIME_THRESHOLD_MS) / RF_KEY_SCAN_CIRCLE_TIMES, // .ho
             -ld_time
 187              0,                                                                                              // .pr
             -ess_cnt
 188          
 189              0,                              // .click_cnt
 190              0,                              // .click_delay_cnt
 191              200 / RF_KEY_SCAN_CIRCLE_TIMES, // .click_delay_time
C51 COMPILER V9.60.7.0   RF_RECV                                                           01/17/2026 16:42:34 PAGE 5   

 192              // NO_KEY,
 193              0,                 // .notify_value
 194              KEY_TYPE_RF,       // .key_type
 195              rf_key_get_key_id, // .get_value
 196          
 197              NO_KEY,         // .latest_key_val
 198              KEY_EVENT_NONE, // .latest_key_event
 199          }; // volatile struct key_driver_para rf_key_para
 200          
 201          /**
 202           * @brief è·å– rf é¥æ§å™¨æŒ‰é”®é”®å€¼ï¼Œä¾› key_driver è°ƒç”¨
 203           *          è¿™é‡Œä¸èƒ½åŒºåˆ†é¥æ§å™¨ç±»å‹ï¼Œåªèƒ½è·å–é¥æ§å™¨æŒ‰é”®
 204           *
 205           * @return u8
 206           */
 207          static u8 rf_key_get_key_id(void)
 208          {
 209   1          if (flag_is_recved_rf_data)
 210   1          {
 211   2              flag_is_recved_rf_data = 0;
 212   2              if (rf_data)
 213   2              {
 214   3                  // u8 ret = (u8)rf_data;
 215   3                  // u8 ret = ((u8)rf_data) & 0x0F; // è·å–ä½4ä½ä½œä¸ºé”®å€¼
 216   3                  u8 ret = ((u8)rf_data) & 0xFF; // è·å–ä½8ä½ä½œä¸ºé”®å€¼
 217   3      
 218   3                  // printf("rf_data 0x %lx\n", rf_data);
 219   3      
 220   3                  
 221   3                  {
 222   4                      // å¦‚æœä¸åœ¨rfå¯¹ç æœŸé—´ï¼Œå¹¶ä¸”é¥æ§å™¨çš„åœ°å€ä¸ä¸€è‡´
 223   4                      // if ((rf_data >> 8) != rf_remote_info.rf_addr)
 224   4                      // if ((rf_data >> 4) != rf_remote_info.rf_addr) // æ•°æ®é«˜20ä½æ˜¯åœ°å€ï¼Œä½4ä½æ˜¯é”
             -®å€¼
 225   4      
 226   4                      if (rf_remote_info.is_addr_valid == 0xC5)
 227   4                      {
 228   5                          // å¦‚æœä¹‹å‰å­˜æ”¾äº†æœ‰æ•ˆçš„é¥æ§å™¨çš„åœ°å€
 229   5                          // åˆ¤æ–­é¥æ§å™¨ç±»å‹ï¼š
 230   5                          if (1 == rf_remote_info.rf_remote_type &&
 231   5                              (rf_data >> 4) == rf_remote_info.rf_addr)
 232   5                          {
 233   6                              // å¦‚æœæ˜¯æ§åˆ¶ä¸€è·¯PWMçš„é¥æ§å™¨ï¼Œæ¥æ”¶åˆ°çš„æ•°æ®ä½4ä½æ˜¯é”®å€¼
 234   6                              ret &= 0x0F;
 235   6                          }
 236   5                          else if (2 == rf_remote_info.rf_remote_type &&
 237   5                                   (rf_data >> 8) == rf_remote_info.rf_addr)
 238   5                          {
 239   6                              // å¦‚æœæ˜¯æ§åˆ¶ä¸¤è·¯PWMçš„é¥æ§å™¨ï¼Œæ¥æ”¶åˆ°çš„æ•°æ®ä½8ä½æ˜¯é”®å€¼
 240   6                              // ret &= 0xFF; // å¯ä»¥ä¸å†™è¿™ä¸€å¥
 241   6                          }
 242   5                          else
 243   5                          {
 244   6                              // å¦‚æœé¥æ§å™¨çš„åœ°å€ä¸ä¸€æ ·
 245   6                              ret = NO_KEY;
 246   6                          }
 247   5                      }
 248   4                      else
 249   4                      {
 250   5                          // å¦‚æœä¹‹å‰æ²¡æœ‰å­˜æ”¾æœ‰æ•ˆçš„é¥æ§å™¨çš„åœ°å€
 251   5                          ret = NO_KEY;
 252   5                      }
C51 COMPILER V9.60.7.0   RF_RECV                                                           01/17/2026 16:42:34 PAGE 6   

 253   4                  }
 254   3      
 255   3                  // printf("key id %bu\n", ret);
 256   3                  rf_data = 0;    // æ¥æ”¶å®Œæˆåï¼Œæ¸…é™¤æ¥æ”¶åˆ°çš„æ•°æ®
 257   3                  return (u8)ret; // ç›´æ¥è·å–é”®å€¼
 258   3              }
 259   2              else
 260   2              {
 261   3                  return NO_KEY;
 262   3              }
 263   2          }
 264   1          else
 265   1          {
 266   2              return NO_KEY;
 267   2          }
 268   1      }
 269          
 270          /**
 271           * @brief __rf_key_get_eventçš„å­å‡½æ•°ï¼Œå°†æŒ‰é”®å€¼å’Œ key_driver_scan å¾—åˆ°çš„æŒ‰é”®äº‹ä»¶è½¬æ¢æˆè
             -§¦æ‘¸æŒ‰é”®çš„äº‹ä»¶
 272           *
 273           * @param key_val è§¦æ‘¸æŒ‰é”®é”®å€¼
 274           * @param key_event åœ¨key_driver_scanå¾—åˆ°çš„æŒ‰é”®äº‹ä»¶ KEY_EVENT
 275           * @param table_index åœ¨å“ªä¸ªè¡¨æ ¼ä¸­è¿›è¡ŒæŸ¥è¡¨ï¼Œ
 276           *                      1--åœ¨æ§åˆ¶ä¸€è·¯PWMé¥æ§å™¨å¯¹åº”çš„è¡¨æ ¼
 277           *                      2--æ§åˆ¶ä¸¤è·¯PWMé¥æ§å™¨å¯¹åº”çš„è¡¨æ ¼
 278           * @return u8
 279           */
 280          static u8 __sub_fun_rf_key_get_event(const u8 key_val, const u8 key_event, const u8 table_index)
 281          {
 282   1          u8 ret_key_event = RF_KEY_EVENT_NONE;
 283   1          u8 i = 0;
 284   1          if (1 == table_index)
 285   1          {
 286   2              for (i = 0; i < ARRAY_SIZE(rf_key_1_event_table); i++)
 287   2              {
 288   3                  // å¦‚æœå¾€ KEY_EVENT æšä¸¾ä¸­æ·»åŠ äº†æ–°çš„æŒ‰é”®äº‹ä»¶ï¼Œè¿™é‡ŒæŸ¥è¡¨çš„æ–¹æ³•å°±ä¼šå¤±æ•
             -ˆï¼Œéœ€è¦æ‰‹åŠ¨ä¿®æ”¹
 289   3                  if (key_val == rf_key_1_event_table[i][0])
 290   3                  {
 291   4                      ret_key_event = rf_key_1_event_table[i][key_event];
 292   4                      break;
 293   4                  }
 294   3              }
 295   2          }
 296   1          else if (2 == table_index)
 297   1          {
 298   2              for (i = 0; i < ARRAY_SIZE(rf_key_1_2_event_table); i++)
 299   2              {
 300   3                  // å¦‚æœå¾€ KEY_EVENT æšä¸¾ä¸­æ·»åŠ äº†æ–°çš„æŒ‰é”®äº‹ä»¶ï¼Œè¿™é‡ŒæŸ¥è¡¨çš„æ–¹æ³•å°±ä¼šå¤±æ•
             -ˆï¼Œéœ€è¦æ‰‹åŠ¨ä¿®æ”¹
 301   3                  if (key_val == rf_key_1_2_event_table[i][0])
 302   3                  {
 303   4                      ret_key_event = rf_key_1_2_event_table[i][key_event];
 304   4                      break;
 305   4                  }
 306   3              }
 307   2          }
 308   1          else
 309   1          {
 310   2              // ä¼ å‚æœ‰è¯¯
 311   2          }
C51 COMPILER V9.60.7.0   RF_RECV                                                           01/17/2026 16:42:34 PAGE 7   

 312   1      
 313   1          return ret_key_event;
 314   1      }
 315          
 316          /**
 317           * @brief å°†æŒ‰é”®å€¼å’Œ key_driver_scan å¾—åˆ°çš„æŒ‰é”®äº‹ä»¶è½¬æ¢æˆè§¦æ‘¸æŒ‰é”®çš„äº‹ä»¶
 318           *          å‡½æ•°å†…éƒ¨ä¼šåšé¥æ§å™¨ç±»å‹åŒºåˆ†
 319           *
 320           * @param key_val è§¦æ‘¸æŒ‰é”®é”®å€¼
 321           * @param key_event åœ¨key_driver_scanå¾—åˆ°çš„æŒ‰é”®äº‹ä»¶ KEY_EVENT
 322           * @return u8 åœ¨ rf_key_event_table ä¸­æ‰¾åˆ°çš„å¯¹åº”çš„æŒ‰é”®äº‹ä»¶ï¼Œå¦‚æœæ²¡æœ‰åˆ™è¿”å› RF_KEY_EVEN
             -T_NONE
 323           */
 324          static u8 __rf_key_get_event(const u8 key_val, const u8 key_event)
 325          {
 326   1          volatile u8 ret_key_event = RF_KEY_EVENT_NONE;
 327   1          u8 i = 0;
 328   1       
 329   1          {
 330   2              // å¦‚æœä¸åœ¨å¯¹ç é˜¶æ®µ
 331   2              if (tmp_rf_addr == rf_remote_info.rf_addr && rf_remote_info.is_addr_valid == 0xC5)
 332   2              {
 333   3                  // ä¹‹å‰å­˜æ”¾äº†æœ‰æ•ˆçš„é¥æ§å™¨ï¼Œå¹¶ä¸”ç°åœ¨è¯»åˆ°çš„é¥æ§å™¨çš„åœ°å€ä¸€æ ·
 334   3                  if (1 == rf_remote_info.rf_remote_type)
 335   3                  {
 336   4                      // å•è·¯PWMé¥æ§å™¨
 337   4                      ret_key_event = __sub_fun_rf_key_get_event(key_val, key_event, 1);
 338   4                  }
 339   3                  else if (2 == rf_remote_info.rf_remote_type)
 340   3                  {
 341   4                      // 1+2ä¸¤è·¯PWMé¥æ§å™¨
 342   4                      ret_key_event = __sub_fun_rf_key_get_event(key_val, key_event, 2);
 343   4                  }
 344   3              }
 345   2              else
 346   2              {
 347   3                  // ret_key_event = RF_KEY_EVENT_NONE;
 348   3              }
 349   2          }
 350   1      
 351   1          return ret_key_event;
 352   1      }
 353          
 354          //  å‡½æ•°å†…éƒ¨ä¼šåšé¥æ§å™¨ç±»å‹åŒºåˆ†
 355          void rf_key_handle(void)
 356          {
 357   1          u8 rf_key_event = RF_KEY_EVENT_NONE;
 358   1      
 359   1          // å¦‚æœæ˜¯æ— æ•ˆçš„æŒ‰é”®ä¿¡æ¯ï¼Œå‡½æ•°ç›´æ¥è¿”å›
 360   1          if (rf_key_para.latest_key_val == NO_KEY)
 361   1          {
 362   2              return;
 363   2          }
 364   1      
 365   1          rf_key_event = __rf_key_get_event(rf_key_para.latest_key_val, rf_key_para.latest_key_event);
 366   1          rf_key_para.latest_key_val = NO_KEY;
 367   1          rf_key_para.latest_key_event = KEY_EVENT_NONE;
 368   1       
 369   1          // printf("rf event %bu\n", rf_key_event);
 370   1      
 371   1          // å¦‚æœæŒ‰é”®åœ°å€æ— æ•ˆï¼Œæœªè¿›è¡Œå¯¹ç ï¼Œå‡½æ•°ç›´æ¥è¿”å›ï¼Œä¸è¿›è¡Œé”®å€¼å¤„ç†
 372   1          // æ­£åœ¨è¿›è¡Œå¯¹ç ï¼Œä¸è¿›è¡Œé”®å€¼å¤„ç†
C51 COMPILER V9.60.7.0   RF_RECV                                                           01/17/2026 16:42:34 PAGE 8   

 373   1          // if (0xC5 != rf_remote_info.is_addr_valid || flag_is_in_rf_learning)
 374   1          if (0xC5 != rf_remote_info.is_addr_valid) /* å¦‚æœä¹‹å‰æœªè¿›è¡Œå¯¹ç ï¼Œä¸è¿›è¡Œé”®å€¼å¤„ç† */
 375   1          {
 376   2              return;
 377   2          }
 378   1       
 379   1          switch (rf_key_event)
 380   1          { 
 381   2          default:
 382   2              break;
 383   2          }
 384   1      }
 385          
 386          void rf_recv_init(void)
 387          {
 388   1      // MY_DEBUG:
 389   1      #if USE_MY_TEST_PIN // æµ‹è¯•æ—¶ä½¿ç”¨ï¼Œåœ¨å¼€å‘æ¿ä¸Šä½¿ç”¨ P01 è„šï¼Œç”¨äºæ£€æµ‹rfä¿¡å·
              
                  P0_PU |= GPIO_P01_PULL_UP(0x01);      // ä¸Šæ‹‰
                  P0_MD0 &= ~(GPIO_P01_MODE_SEL(0x03)); // è¾“å…¥æ¨¡å¼
              
              #else // å®é™…ç”¨åˆ°çš„ã€éæµ‹è¯•æ—¶ä½¿ç”¨çš„rfä¿¡å·æ£€æµ‹å¼•è„šï¼š
 395   1      
 396   1          P0_PU |= GPIO_P03_PULL_UP(0x01);      // ä¸Šæ‹‰
 397   1          P0_MD0 &= ~(GPIO_P03_MODE_SEL(0x03)); // è¾“å…¥æ¨¡å¼
 398   1      
 399   1      #endif // #if USE_MY_TEST_PIN
 400   1      
 401   1          // æ£€æµ‹æœ‰æ— 433é¥æ§å™¨åŠŸèƒ½çš„å¼•è„šï¼š
 402   1          P1_PU |= GPIO_P11_PULL_UP(0x01);      // ä¸Šæ‹‰
 403   1          P1_MD0 &= ~(GPIO_P11_MODE_SEL(0x03)); // è¾“å…¥æ¨¡å¼
 404   1      
 405   1          if (0 == RF_ENABLE_PIN) // æ£€æµ‹è„šæ¥äº†0Rç”µé˜»åˆ°GNDï¼Œè¯´æ˜æœ‰433é¥æ§å™¨çš„åŠŸèƒ½
 406   1          {
 407   2              flag_is_rf_enable = 1;
 408   2          }
 409   1          else // æ£€æµ‹è„šæœªæ¥0Rç”µé˜»ï¼Œè¯´æ˜æ²¡æœ‰433é¥æ§å™¨çš„åŠŸèƒ½
 410   1          {
 411   2              flag_is_rf_enable = 0;
 412   2          }
 413   1       
 414   1       
 415   1      }

C51 COMPILATION COMPLETE.  0 WARNING(S),  12 ERROR(S)
